<style>
    /* Estilo do título */
.option_form {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 colunas de largura igual */
    padding: 5px;
    background-color: #f3f4f6; /* Cor de fundo similar ao estilo Windows 11 */
    border-radius: 8px;   
    font-weight: bold;
    margin:0 -1.25rem -1.1rem -1.25rem!important;
}

/* Estilo das linhas do cliente */
.option_form_cliente {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 colunas de largura igual */
    padding: 5px;
    border-radius: 8px;
    margin: -0.4rem!important;
}

/* Estilo das células individuais */
.option_form div, .option_form_cliente div {
    padding: 8px;
    text-align: center; /* Centraliza o texto dentro das células */
    border-left: 0.1rem solid rgb(230, 223, 218);
    border-right: 0.1rem solid rgb(230, 223, 218);
}

/* Ícone para o título */
.option_form i {
    font-size: 1.5em;
    color: #0078d4; /* Cor azul do Windows 11 */
}
</style>
<div class="container m-0 w-100">
    {% include "Escola/partials/mensagens.html" %}
    <div class="alert alert-info" role="alert">
        <h4 class="alert-heading">Instruções para Criação de Contrato no Aprendix</h4>
        <p>Após cadastrar uma pessoa no sistema Aprendix, é fundamental que você crie o contrato correspondente para o ano letivo. Para isso, siga os passos abaixo:</p>
        <ol>
            <li><strong>Localize o cadastro na tabela abaixo:</strong> Encontre a pessoa que você acabou de cadastrar.</li>
            <li><strong>Criar Contrato:</strong> Clique na opção “Criar + [ano letivo]” para iniciar a elaboração do contrato.</li>
        </ol>
        <p>Certifique-se de preencher todas as informações necessárias e revisar os dados antes de finalizar o processo. Isso garantirá que o contrato esteja correto e completo, evitando possíveis problemas futuros.</p>
    </div>
</div>

<table class="win11-table">
    <thead>
        <tr>
            <th>Ordem</th>
            <th>Nome completo</th>
            <th>Gênero Sexual</th>
            <th>Data Nascimento </th>
            <th>Idade</th>
            <th>RG</th>
            <th>
                <div class="option_form">
                    <div>Último Contrato</div>
                    <div><i class="fa-regular fa-book-copy" title="Ver todos os contratos da pessoa"></i><br> Contratos</div>
                    <div><i class="fa-duotone fa-solid fa-school-flag" title="Vinculado a escolar {{request.session.escola_nome}}?"></i> <br> Encaminhamentos </div>
                    <div><i class="fa-duotone fa-solid fa-chalkboard-user" title="Professor?"></i></div>
                </div>   
            </th>
            <th>Ação</th>
        </tr>
    </thead>
    <tbody>
        {% for l in pessoas %}
        <tr>
            <td>{{forloop.counter}}</td>
            <td class="text-uppercase text-start"> {{l.nome}} {{l.sobrenome}} </td>
            <td>{% if l.sexo is not None %}{{l.sexo}}{% else %} Não especificou {% endif %}</td>
            <td>{{ l.data_nascimento }} {% if l.e_aniversario_hoje %}<span class="e_aniversario btn border "><i class="fa-thin fa-balloons"></i>  Aniversariante <i class="fa-sharp-duotone fa-solid fa-cake-candles"></i></span>{% endif %}</td>
            <td>{{l.idade}}</td>
            <td>{{l.rg}}</td>
            <td>               
                
                <div class="option_form_cliente">                    
                    <div>
                        {% if l.pessoa_contratada.last.ano_contrato.ano is not None %}
                            {% comment "Verifica se existe algum contrato para o profissional" %}{% endcomment %}
                            {% if request.session.anoLetivo_nome == l.pessoa_contratada.last.ano_contrato.ano %} 
                            {% comment "Verifica se o profissional foi contratado para o ano letivo atual" %}{% endcomment %}
                                <i class="fa-duotone fa-solid fa-check fa-beat text-success fs-4" title="Contratado para ano letivo de {{request.session.anoLetivo_nome}}?"></i> 
                                {{l.pessoa_contratada.last.ano_contrato.ano}}                           
                                {% else %}
                                    {{l.pessoa_contratada.last.ano_contrato.ano}} <a class='btn btn-primary p-1 fs-8' title='{% include "Escola/partials/pessoas/texto.html" %}' href="{% url 'Gestao_Escolar:pessoasContrato-create' l.id %}">Criar <i class="fa-solid fa-plus"></i> {{request.session.anoLetivo_nome}}</a>
                            {% endif %} 
                            {% else %}
                            {% comment "Caso não haja contrato é exibido a opção para contratar" %}{% endcomment %}
                            Não há nenhum contrato  
                            {{l.pessoa_contratada.last.ano_contrato.ano}} <a class='btn btn-primary p-1 fs-8' title='{% include "Escola/partials/pessoas/texto.html" %}' href="{% url 'Gestao_Escolar:pessoasContrato-create' l.id %}">Criar <i class="fa-solid fa-plus"></i> {{request.session.anoLetivo_nome}}</a>
                        {% endif %}  
                    </div>
                    <div>{% include "Escola/partials/pessoas/anos_contratos.html" %}   </div>
                    <div>                        
                        {% if l.pessoa_contratada.last.ano_contrato.ano is not None %}     
                            {% if request.session.anoLetivo_nome == l.pessoa_contratada.last.ano_contrato.ano %} 
                                {% for e in l.pessoa_contratada.last.encaminhamento_escolar.all  %}
                                    {% if e.encaminhamento.ano_contrato.ano == request.session.anoLetivo_nome %}
                                        {{e.destino.nome_escola}}
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                            "Profissional ainda não contratado em {{request.session.anoLetivo_nome}}. Antes de encaminhá-lo, é necessário efetuar a contratação."
                            {% endif %}                        
                        {% endif %}
                    {% if l.pessoa_contratada.last.ano_contrato.ano %}
                        {% if not request.session.anoLetivo_nome == l.pessoa_contratada.last.ano_contrato.ano %} 
                            <a class='btn btn-primary p-1 fs-8' title='Disponibiliza o profissional para a escola' href="{% url 'Gestao_Escolar:encaminha_escola' l.id %}">Todos
                        {% endif %}                        
                    {% endif %}</a>
                    </div>
                    <div>
                        {{l.pessoa_contratada.last.encaminhamento_escolar.last.profissao}}
                    </div>
                </div>                  
            </td>
            <td><a href="{% url "Gestao_Escolar:pessoas-update" l.pk %}" title='Editar informações pessoais'><i class="fa-duotone fa-solid fa-user-pen"></i></a></td>
            
        </tr>
        {% endfor %}
    </tbody>
</table>

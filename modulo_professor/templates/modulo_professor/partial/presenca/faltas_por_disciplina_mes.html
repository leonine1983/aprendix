{% extends "modulo_professor/base.html" %}

{% block main %}
<div class="bg-light rounded-3 shadow p-4 print-area">

    <!-- Cabeçalho com botão de impressão -->
    <div class="d-flex flex-wrap align-items-center justify-content-between mb-4 ">
        <div>
            <h2 class="mb-0">{{ turma_disciplina.turma }}</h2>
            <p class="text-muted">{{ turma_disciplina }}</p>
        </div>
        <div class="d-flex align-items-end gap-2">
            <form method="get" class="d-flex align-items-end gap-2">
                <div class="form-group">
                    <label for="mes" class="form-label mb-0">Mês de referência:</label>
                    <input type="month" class="form-control" id="mes" name="mes" value="{{ mes }}">
                </div>
                <button type="submit" class="btn btn-primary no-print">Filtrar</button>
            </form>
            <button class="btn btn-outline-secondary no-print" onclick="window.print()">
                <i class="bi bi-printer-fill me-1"></i> Imprimir
            </button>
        </div>
    </div>

    <!-- Conteúdo imprimível -->
    <div class="">

        <!-- Alerta (opcionalmente pode ser removido da impressão) -->
        <div class="alert alert-info no-print" role="alert">
            <h5 class="alert-heading"><i class="bi bi-info-circle-fill me-2"></i>Registro de Frequência por Disciplina</h5>
            <hr>
            <p class="mb-0 small">Consulte abaixo a quantidade de faltas dos alunos neste mês. Para dúvidas, entre em contato com a coordenação pedagógica.</p>
        </div>

        <!-- Tabela de faltas -->
        <div class="table-responsive mt-4">
            <table class="table table-bordered table-hover align-middle">
                <thead class="table-secondary">
                    <tr>
                        <th>Aluno</th>
                        <th>Total de Faltas ({{ mes|date:"m/Y" }})</th>
                    </tr>
                </thead>
                <tbody>
                    {% for matricula, faltas in faltas_por_aluno.items %}
                    <tr>
                        <td>{{ matricula.aluno.nome_completo }}</td>
                        <td>
                            {% if faltas == 0 %}
                                <span class="badge bg-success">0</span>
                            {% else %}
                                <span class="badge bg-danger">{{ faltas }}</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" class="text-center text-muted">Nenhum aluno registrado.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>

<!-- Estilo para controlar o que é impresso -->
<style>
    @media print {
        body * {
            visibility: hidden;
        }
        .print-area, .print-area * {
            visibility: visible;
        }
        .print-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }
        .no-print {
            display: none !important;
        }
    }
</style>
{% endblock main %}
